blueprint:
  name: On at Sunset off later
  description: Turn a light on at Sunset, off at a specified time
  domain: automation
  input:
    target_light:
      name: Light
      description: Light (or Light Group) to be turned on/off
      selector:
        entity:
          domain: light
    target_brightness:
      name: Brightness
      description: Brightness to set light to (in %, normall 15)
      selector:
        number:
          min: 0.0
          max: 100.0
          step: 5.0
          unit_of_measurement: '%'
          mode: slider
    off_time:
      name: Time
      description: Time (HH:MM) to turn off Light
      selector:
        time: {}
trigger:
- platform: sun
  event: sunset
- platform: time
  at:
    - !input off_time
action:
  - choose:
    # If we are triggered, but before the "off_time", it must be sunset, so turn the light on.
    - conditions:
      - condition: time
        before: !input 'off_time'
      sequence:
        - service: light.turn_on
          data:
            brightness: !input 'target_brightness'
          entity_id: !input 'target_light'
    # If we didn't match the before trigger, it must be the time trigger, so turn the light off.
    default:
      - service: light.turn_off
        entity_id: !input 'target_light'
